package blockutil

import (
	"fmt"
	"os"

	"github.com/paulwizviz/datalake/internal/block"
	"google.golang.org/protobuf/proto"
)

func Example_unmarshal() {

	filekey := "0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22"

	b, err := os.ReadFile("./testdata/0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22.datalake.pb")
	if err != nil {
		fmt.Println(err)
		return
	}

	var blk block.Block
	err = proto.Unmarshal(b, &blk)
	if err != nil {
		fmt.Println(err)
	}
	if filekey == blk.Hash {
		fmt.Println(blk.Number)
	}

	// Output:
	// 876
}

func Example_parseList() {
	content, err := os.ReadFile("./testdata/list.xml")
	if err != nil {
		fmt.Println(err)
	}
	results, err := extractListKeys(content)
	if err != nil {
		fmt.Println(err)
	}
	for _, r := range results {
		fmt.Println(r)
	}
	// Output:
	// 0x0026bfb13bbb89d75f267d5e3fb7eccf64c506dd9e33daa288de6b8489f60c32.datalake
	// 0x007fbfdef1d22b4cc74826b45c05ae8699932892a268260debc2ba907b62c65d.datalake
}

func Example_readBlocalByHash() {
	blk, err := ReadBlockByHash(S3URL, "0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22")
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println(*blk)
	// Output:
	// {{{} [] [] 0xc000026800} 0 [] 0 26167870079 [71 101 116 104 47 76 86 73 86 47 118 49 46 48 46 48 47 108 105 110 117 120 47 103 111 49 46 52 46 50] 5000 0 0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22 [48 120 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48] 0xbb7B8287f3F0a933474a79eAe42CBCa977791171 0x003484e5c227608035afffb3ef98159f91698cad6e4f2029d92e22ff7d5c6cd8 2605441722903303423 876 0x16e5f82a416b07018b2850e64674eea9ccbd30570b5559f5cec06585380e2dd9 0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347 544 0x15ae8aeb020258e64c85cfe2f873f9dad1810181b209804abb0a29da639a0e73 1438271908 18673944942049 [] 0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421 []}
}

func Example_readBlockByHashC() {
	blk, err := ReadBlockByHashC("./testdata", "0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22")
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println(*blk)
	// Output:
	// {{{} [] [] 0xc000026800} 0 [] 0 26167870079 [71 101 116 104 47 76 86 73 86 47 118 49 46 48 46 48 47 108 105 110 117 120 47 103 111 49 46 52 46 50] 5000 0 0x0a54e58aaefd6599c4c3054778b13971c2da94ea79f7492e3b7cbf04e66e3d22 [48 120 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48] 0xbb7B8287f3F0a933474a79eAe42CBCa977791171 0x003484e5c227608035afffb3ef98159f91698cad6e4f2029d92e22ff7d5c6cd8 2605441722903303423 876 0x16e5f82a416b07018b2850e64674eea9ccbd30570b5559f5cec06585380e2dd9 0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347 544 0x15ae8aeb020258e64c85cfe2f873f9dad1810181b209804abb0a29da639a0e73 1438271908 18673944942049 [] 0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421 []}
}

func Example_readBlockByNum() {
	blk, err := ReadBlockByNumber("./testdata", "1")
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println(blk.Number)
	// Output:
	// 1
}
